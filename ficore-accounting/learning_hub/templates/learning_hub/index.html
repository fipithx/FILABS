<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ tool_title }}</title>
    <link rel="stylesheet" href="{{ url_for('learning_hub.static', filename='css/learning_hub.css') }}">
</head>
<body>
    <header>
        <h1>{{ t('learning_hub_title', default='Learning Hub') }}</h1>
        <nav>
            {% for tool in tools %}
                <a href="{{ url_for(tool['endpoint']) }}">{{ t(tool['title_key'], default=tool['title']) }}</a>
            {% endfor %}
        </nav>
    </header>

    <main>
        <section id="courses">
            <h2>{{ t('learning_hub_courses', default='Courses') }}</h2>
            <form method="POST" action="{{ url_for('learning_hub.set_role_filter') }}">
                <label for="role_filter">{{ t('learning_hub_role_filter', default='Filter by Role') }}</label>
                <select name="role" id="role_filter" onchange="this.form.submit()">
                    <option value="all" {% if role_filter == 'all' %}selected{% endif %}>{{ t('learning_hub_all_roles', default='All Roles') }}</option>
                    <option value="civil_servant" {% if role_filter == 'civil_servant' %}selected{% endif %}>{{ t('learning_hub_civil_servant', default='Civil Servant') }}</option>
                    <option value="nysc" {% if role_filter == 'nysc' %}selected{% endif %}>{{ t('learning_hub_nysc', default='NYSC Member') }}</option>
                    <option value="agent" {% if role_filter == 'agent' %}selected{% endif %}>{{ t('learning_hub_agent', default='Agent') }}</option>
                </select>
            </form>

            {% for theme, courses in courses.items() %}
                <h3>{{ t('learning_hub_theme_' + theme, default=theme.replace('_', ' ').title()) }}</h3>
                <div class="course-list">
                    {% for course_id, course in courses.items() %}
                        <div class="course-card">
                            <h4>{{ t(course.title_key, default=course.title_en) }}</h4>
                            <p>{{ t(course.desc_key, default=course.description_en) }}</p>
                            <a href="#course-{{ course_id }}">{{ t('learning_hub_start_course', default='Start Course') }}</a>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </section>

        <section id="progress">
            <h2>{{ t('learning_hub_progress', default='Your Progress') }}</h2>
            <p>{{ t('learning_hub_total_completed', default='Lessons Completed') }}: {{ total_completed }}</p>
            <p>{{ t('learning_hub_quiz_scores', default='Quiz Scores') }}: {{ quiz_scores_count }}</p>
            <p>{{ t('learning_hub_certificates', default='Certificates Earned') }}: {{ certificates_earned }}</p>
            <p>{{ t('learning_hub_coins', default='Coins Earned') }}: {{ total_coins_earned }}</p>
        </section>

        {% if is_admin() %}
        <section id="upload">
            <h2>{{ t('learning_hub_upload_content', default='Upload New Content') }}</h2>
            <form method="POST" enctype="multipart/form-data">
                {{ upload_form.hidden_tag() }}
                {{ upload_form.title.label }} {{ upload_form.title }}
                {{ upload_form.course_id.label }} {{ upload_form.course_id }}
                {{ upload_form.description.label }} {{ upload_form.description }}
                {{ upload_form.content_type.label }} {{ upload_form.content_type }}
                {{ upload_form.is_premium.label }} {{ upload_form.is_premium }}
                {{ upload_form.roles.label }} {{ upload_form.roles }}
                {{ upload_form.theme.label }} {{ upload_form.theme }}
                {{ upload_form.file.label }} {{ upload_form.file }}
                {{ upload_form.submit }}
                <input type="hidden" name="action" value="upload">
            </form>
        </section>
        {% endif %}
    </main>

    <footer>
        {% for item in bottom_nav_items %}
            <a href="{{ url_for(item['endpoint']) }}">{{ t(item['title_key'], default=item['title']) }}</a>
        {% endfor %}
    </footer>

    <script src="{{ url_for('learning_hub.static', filename='js/learning_hub.js') }}"></script>
</body>
</html>